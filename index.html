<!DOCTYPE html>
<html>
<head>
    <title>Sols Rng Calculator</title>
    <style>
        body { font-family: sans-serif; padding: 20px; background: #050a0f; color: white; display: flex; justify-content: center; align-items: center; min-height: 100vh; margin: 0; }
        .calc-card { width: 100%; max-width: 420px; background: #0d141f; padding: 25px; border-radius: 12px; border: 2px solid #00d4ff; box-shadow: 0 0 20px rgba(0, 212, 255, 0.4), 0 0 40px rgba(0, 212, 255, 0.2), 0 0 80px rgba(0, 212, 255, 0.1); }
        h2 { text-align: center; text-transform: uppercase; margin-top: 0; margin-bottom: 20px; letter-spacing: 2px; }
        .mode-switch { display: flex; background: #000; border-radius: 10px; padding: 6px; margin-bottom: 20px; border: 2px solid #444; }
        .mode-btn { flex: 1; padding: 12px; border: none; background: none; color: #888; cursor: pointer; font-weight: 900; font-size: 0.8rem; border-radius: 7px; text-transform: uppercase; }
        .mode-btn.active { background: #add8e6; color: #000; }
        .section { margin-bottom: 15px; padding: 12px; background: #161c26; border-radius: 8px; border: 1px solid #2a3545; }
        .rarity-container { display: flex; align-items: center; background: #000; border: 1px solid #444; border-radius: 5px; padding: 0 10px; margin: 8px 0; }
        .prefix { font-weight: bold; margin-right: 5px; font-size: 1.1rem; }
        .rarity-input { border: none !important; margin: 0 !important; outline: none; width: 100%; }
        input, select { width: 100%; padding: 10px; margin: 8px 0; border-radius: 5px; border: 1px solid #444; background: #000; color: white; font-weight: bold; box-sizing: border-box; font-size: 0.9rem; }
        label { font-size: 0.75rem; color: #ccc; display: block; }
        .check-grid { display: grid; grid-template-columns: repeat(3, 1fr); gap: 5px; margin: 10px 0; }
        .check-row { display: flex; align-items: center; gap: 8px; cursor: pointer; font-size: 0.75rem; color: #888; }
        .check-row input { width: 16px; height: 16px; margin: 0; cursor: pointer; }
        .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
        .result-box { padding: 20px; border-radius: 8px; text-align: center; margin-top: 10px; border: 2px solid #add8e6; background: rgba(173, 216, 230, 0.05); transition: border-color 0.3s; }
        .result-val { font-size: 2.1rem; font-weight: bold; color: #add8e6; margin: 5px 0; }
        .luck-status { font-size: 0.8rem; font-weight: bold; text-transform: uppercase; color: #add8e6; display: block; height: 1rem; }
        .stat-subtext { font-size: 0.7rem; color: #888; margin-top: 5px; display: block; }
        .status-low { border-color: #ff4d4d !important; } .status-mid { border-color: #ffcc00 !important; } .status-high { border-color: #00ff88 !important; }
        .footer { display: flex; justify-content: space-between; align-items: flex-end; margin-top: 20px; padding-top: 10px; border-top: 1px solid #333; }
        .discord-link { color: #7289da; font-size: 0.75rem; text-decoration: none; font-weight: bold; }
        .reset-btn { background: #2a2a35; color: #ccc; border: 1px solid #444; padding: 6px 12px; border-radius: 4px; font-size: 0.75rem; cursor: pointer; }
    </style>
</head>
<body>

<div class="calc-card">
    <form id="calcForm" onsubmit="return false;">
        <h2>Sols Rng Calculator</h2>
        <div class="mode-switch">
            <button type="button" id="btnChance" class="mode-btn active" onclick="setMode('chance')">ROLL CHANCE</button>
            <button type="button" id="btnTime" class="mode-btn" onclick="setMode('time')">TIME REQUIRED</button>
        </div>

        <div class="section">
            <label>Rarity of Aura</label>
            <div class="rarity-container">
                <span class="prefix">1/</span>
                <input type="number" id="rarity" class="rarity-input" value="2500000000">
            </div>
            <div id="rainyContainer" style="display:none; margin-bottom: 10px;"><label class="check-row" style="color: #add8e6;"><input type="checkbox" id="isRainy"> Rainy Aura?</label></div>
            <div class="grid-2">
                <div><label>Luck (Incl. Base)</label><input type="number" id="luck" value="30"></div>
                <div><label>Left Hand (Luck)</label>
                    <select id="leftGlove" onchange="checkRainySupport()">
                        <option value="1">None</option><option value="1.98">Unfathomable</option><option value="1.8">Darkshader</option><option value="pole">Pole Light</option><option value="grav">Gravitational</option><option value="1.3">Flesh Device</option><option value="jackpot">Jackpot</option><option value="gemstone">Gemstone</option>
                        <option value="xmas" class="event-luck" style="display:none;">X-Mas Champ</option><option value="present" class="event-luck" style="display:none;">Present Giver</option><option value="blessed" class="event-luck" style="display:none;">Blessed Tide</option><option value="tide" class="event-luck" style="display:none;">Tide Gauntlet</option><option value="1.35" class="event-luck" style="display:none;">Ominous Coffin</option>
                    </select>
                </div>
            </div>
            <div class="check-grid">
                <label class="check-row"><input type="checkbox" id="vip"> VIP</label><label class="check-row"><input type="checkbox" id="vipPlus"> VIP+</label><label class="check-row"><input type="checkbox" id="event2x"> 2x Event</label>
            </div>
            <label class="check-row" style="margin-top: 10px;"><input type="checkbox" id="showEventLuck" onchange="toggleEvents()"> Show Event Gear</label>
        </div>

        <div class="section">
            <label style="color: #00d4ff; font-weight: bold; margin-bottom: 8px;">Roll Speed Buffs</label>
            <label>Right Hand (Speed)</label>
            <select id="rightGlove">
                <option value="0">None</option><option value="120">Heavenly Device (+120%)</option><option value="100">Genesis Drive (+100%)</option><option value="70">Neuralyzer (+70%)</option><option value="50">Starshaper (+50%)</option><option value="40">Ragnar√∂ker (+40%)</option><option value="35">Hologrammer (+35%)</option><option value="35.1">Exoflex (+35%)</option><option value="35.2">Volcanic (+35%)</option><option value="30">Galactic (+30%)</option><option value="30.1">Subzero (+30%)</option><option value="25">Windstorm (+25%)</option><option value="25.1">Frozen Gauntlet (+25%)</option><option value="20">Exo Gauntlet (+20%)</option><option value="15">Eclipse (+15%)</option><option value="15.1">Lunar Device (+15%)</option>
                <option value="30.2" class="event-speed" style="display:none;">Snow Rider (+30%)</option><option value="30.3" class="event-speed" style="display:none;">Vampire Hunter (+30%)</option><option value="-50" class="event-speed" style="display:none;">Pump Punch (-50%)</option>
            </select>
            <div class="grid-2">
                <div><label>Resonance % (Max 22)</label><input type="number" id="resonance" value="0" min="0" max="22" oninput="if(this.value>22)this.value=22"></div>
                <div style="display: flex; align-items: flex-end;"><label class="check-row" style="margin-bottom: 15px;"><input type="checkbox" id="showEventSpeed" onchange="toggleEvents()"> Show Event Gear</label></div>
            </div>
            <div class="grid-2">
                <div><label>Bank</label><select id="buffBank"><option value="0">None</option><option value="7">Bank (+7%)</option></select></div>
                <div><label>Speed Potion</label><select id="buffBasic"><option value="0">None</option><option value="10">Speed Potion (+10%)</option></select></div>
            </div>
            <div class="grid-2">
                <div><label>Haste Potion</label><select id="buffHaste"><option value="0">None</option><option value="20">Haste I (+20%)</option><option value="25">Haste II (+25%)</option><option value="30">Haste III (+30%)</option></select></div>
                <div><label>Godly Potion</label>
                    <select id="buffGod">
                        <option value="0">None</option><option value="75">Poseidon (+75%)</option><option value="30">Zeus (+30%)</option><option value="-10">Hades (-10%)</option>
                    </select>
                </div>
            </div>
            <div class="grid-2">
                <div><label>Strange/Rudolph</label><select id="buffKnowledge"><option value="0">None</option><option value="30">Knowledge 1 (+30%)</option><option value="40">Knowledge 2 (+40%)</option><option value="20">Rudolph (+20%)</option><option value="-15">Sloth 1 (-15%)</option><option value="-25">Sloth 2 (-25%)</option></select></div>
                <div><label>Event Potion</label><select id="buffEventPot"><option value="0">None</option><option value="20">Santa (+20%)</option><option value="25">Hwache (+25%)</option></select></div>
            </div>
            <label>Other Potions</label><select id="buffCombat"><option value="0">None</option><option value="35">Rage Pot (+35%)</option><option value="40">Diver Pot (+40%)</option></select>
        </div>

        <div id="sectionChance" class="section">
            <label>Time Period (Days)</label><input type="number" id="days" placeholder="Days to roll">
            <div class="result-box" id="chanceBox">
                <div class="result-val" id="outputChance">0.00%</div>
                <span class="luck-status" id="chanceLabel">WAITING...</span>
                <span class="stat-subtext" id="totalRolls">0 total rolls</span>
            </div>
        </div>

        <div id="sectionTime" class="section" style="display:none;">
            <label>Target Success Rate (%)</label><input type="number" id="targetP" placeholder="Target % (e.g. 50)">
            <div class="result-box" id="timeBox">
                <div class="result-val" id="outputTime">-- Days</div>
                <span class="luck-status" id="timeLabel">AFK TIME</span>
                <span class="stat-subtext" id="rollsNeeded">0 rolls needed</span>
            </div>
        </div>

        <div class="footer">
            <div><a href="https://discord.gg/yTreH64JBC" class="discord-link" target="_blank">Join Discord!</a><div style="font-size:0.6rem; color:#666;">By @LubJub</div></div>
            <button type="button" class="reset-btn" onclick="fullReset()">Reset</button>
        </div>
    </form>
</div>

<script>
    let currentMode = 'chance';
    function setMode(mode) {
        currentMode = mode;
        document.getElementById('sectionChance').style.display = (mode === 'chance') ? 'block' : 'none';
        document.getElementById('sectionTime').style.display = (mode === 'time') ? 'block' : 'none';
        document.getElementById('btnChance').classList.toggle('active', mode === 'chance');
        document.getElementById('btnTime').classList.toggle('active', mode === 'time');
        calculate();
    }
    function toggleEvents() {
        const luckChecked = document.getElementById('showEventLuck').checked;
        const speedChecked = document.getElementById('showEventSpeed').checked;
        document.querySelectorAll('.event-luck').forEach(el => el.style.display = luckChecked ? "block" : "none");
        document.querySelectorAll('.event-speed').forEach(el => el.style.display = speedChecked ? "block" : "none");
        
        // AUTO-RESET LOGIC: If box is unticked and wearer has event gear, go to "None"
        if (!luckChecked && document.getElementById('leftGlove').selectedOptions[0].classList.contains('event-luck')) {
            document.getElementById('leftGlove').value = "1";
        }
        if (!speedChecked && document.getElementById('rightGlove').selectedOptions[0].classList.contains('event-speed')) {
            document.getElementById('rightGlove').value = "0";
        }
        
        checkRainySupport();
    }
    function checkRainySupport() {
        const v = document.getElementById('leftGlove').value;
        document.getElementById('rainyContainer').style.display = (v === "tide" || v === "blessed") ? "block" : "none";
        calculate();
    }
    function fullReset() { document.getElementById('calcForm').reset(); toggleEvents(); checkRainySupport(); setMode('chance'); }

    function calculate() {
        const R = parseFloat(document.getElementById('rarity').value) || 1;
        const L = parseFloat(document.getElementById('luck').value) || 0;
        const left = document.getElementById('leftGlove').value;
        const rainy = document.getElementById('isRainy').checked;
        let luckM = 1;
        const v = document.getElementById('vip').checked, vp = document.getElementById('vipPlus').checked;
        if (v && vp) luckM = 1.3; else if (v || vp) luckM = 1.2;
        if (document.getElementById('event2x').checked) luckM *= 2;
        let rawL = L / luckM, pAvg, speedM = 1;
        const rDiv = rainy ? 4 : 1;
        
        // Luck Calculation
        if (left === "blessed") { pAvg = (5 * (rawL / R) + 1 * ((rawL * 3) / (R / rDiv))) / 6 * luckM; }
        else if (left === "tide") { pAvg = (9 * ((rawL + 0.5) / R) + 1 * (((rawL + 0.5) * 2) / (R / rDiv))) / 10 * luckM; }
        else {
            let add = 0, mg = 1;
            if (left === "pole") { add = 5; mg = 1.1; speedM += (34/30)-1; }
            else if (left === "jackpot") { add = 0.77; speedM += 0.07; }
            else if (left === "grav") { mg = 1.5; }
            else if (left === "gemstone") { add = 0.075; }
            else if (left === "xmas") { mg = 1.5; }
            else if (left === "present") { mg = 1.36; }
            else if (left === "1.35") { mg = 1.35; }
            else { mg = parseFloat(left) || 1; }
            pAvg = ((rawL + add) * mg * luckM) / R;
        }

        // Speed Calculation
        speedM += (parseFloat(document.getElementById('resonance').value) || 0) / 100;
        const buffIds = ['rightGlove', 'buffBank', 'buffBasic', 'buffHaste', 'buffGod', 'buffKnowledge', 'buffEventPot', 'buffCombat'];
        buffIds.forEach(id => speedM += (parseFloat(document.getElementById(id).value) || 0) / 100);
        
        const rpd = 86400 * Math.max(0.01, speedM);
        const d = parseFloat(document.getElementById('days').value) || 0;
        const totalRolls = rpd * d;
        const P = (d > 0 && pAvg > 0) ? 1 - Math.pow((1 - pAvg), totalRolls) : 0;
        
        document.getElementById('outputChance').innerText = (P >= 0.9999999) ? "99.99%+" : (P * 100).toFixed(2) + "%";
        document.getElementById('totalRolls').innerText = Math.floor(totalRolls).toLocaleString() + " rolls";
        
        const targetVal = (parseFloat(document.getElementById('targetP').value) || 0) / 100;
        if (targetVal > 0 && targetVal < 1 && pAvg > 0) {
            const n = Math.log(1 - targetVal) / Math.log(1 - pAvg);
            const daysNeeded = n / rpd;
            document.getElementById('outputTime').innerText = daysNeeded > 1000 ? daysNeeded.toExponential(2) + " Days" : daysNeeded.toFixed(2) + " Days";
            document.getElementById('rollsNeeded').innerText = Math.ceil(n).toLocaleString() + " rolls needed";
        } else {
            document.getElementById('outputTime').innerText = "-- Days";
            document.getElementById('rollsNeeded').innerText = "0 rolls needed";
        }
        updateVisuals('chance', P, d > 0);
        updateVisuals('time', targetVal, targetVal > 0);
    }

    function updateVisuals(id, prob, hasData) {
        const b = document.getElementById(id + 'Box');
        const l = document.getElementById(id + 'Label');
        b.classList.remove('status-low', 'status-mid', 'status-high');
        if (!hasData) {
            l.innerText = (id === 'chance' ? "WAITING..." : "AFK TIME");
            l.style.color = "#add8e6"; return;
        }
        if (prob < 0.1) { b.classList.add('status-low'); l.innerText = "Extreme Longshot"; l.style.color = "#ff4d4d"; }
        else if (prob < 0.5) { b.classList.add('status-mid'); l.innerText = "Fair Odds"; l.style.color = "#ffcc00"; }
        else { b.classList.add('status-high'); l.innerText = "Safe Bet"; l.style.color = "#00ff88"; }
    }
    document.querySelectorAll('input, select').forEach(el => el.addEventListener('input', calculate));
    calculate();
</script>
</body>
</html>
