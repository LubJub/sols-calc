<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sols Rng Calculator | Optimized</title>
    <style>
        :root {
            --bg-dark: #0b0b0e;
            --card-bg: #16161d;
            --accent: #add8e6;
            --input-bg: #000;
            --border: #3e3e4a;
            --text-dim: #ccc;
        }

        body { 
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; 
            padding: 20px; 
            background: var(--bg-dark); 
            color: white; 
            display: flex; 
            justify-content: center; 
            line-height: 1.5;
        }

        .calc-card { 
            width: 100%; 
            max-width: 420px; 
            background: var(--card-bg); 
            padding: 25px; 
            border-radius: 16px; 
            border: 2px solid var(--border); 
            box-shadow: 0 10px 30px rgba(0,0,0,0.6); 
        }

        h2 { text-align: center; text-transform: uppercase; margin-top: 0; letter-spacing: 2px; color: var(--accent); }

        .mode-switch { 
            display: flex; 
            background: #000; 
            border-radius: 12px; 
            padding: 5px; 
            margin-bottom: 25px; 
            border: 1px solid #444; 
        }

        .mode-btn { 
            flex: 1; 
            padding: 12px; 
            border: none; 
            background: none; 
            color: #666; 
            cursor: pointer; 
            font-weight: bold; 
            font-size: 0.8rem; 
            border-radius: 8px; 
            transition: all 0.3s ease;
        }

        .mode-btn.active { 
            background: var(--accent); 
            color: #000; 
        }

        .section { 
            margin-bottom: 20px; 
            padding: 15px; 
            background: #1c1c26; 
            border-radius: 10px; 
        }

        .rarity-container { 
            display: flex; 
            align-items: center; 
            background: var(--input-bg); 
            border: 1px solid #444; 
            border-radius: 8px; 
            padding: 0 12px; 
            margin: 8px 0; 
        }

        .prefix { font-weight: bold; margin-right: 5px; font-size: 1.1rem; }
        
        input, select { 
            width: 100%; 
            padding: 12px; 
            margin: 8px 0; 
            border-radius: 8px; 
            border: 1px solid #444; 
            background: var(--input-bg); 
            color: white; 
            font-weight: bold; 
            box-sizing: border-box; 
            transition: border-color 0.2s;
        }

        input:focus, select:focus { border-color: var(--accent); outline: none; }

        label { font-size: 0.85rem; color: var(--text-dim); }

        .check-grid { 
            display: grid; 
            grid-template-columns: 1fr 1fr; 
            gap: 10px; 
            margin: 10px 0; 
        }

        .check-row { 
            display: flex; 
            align-items: center; 
            gap: 8px; 
            cursor: pointer; 
            font-size: 0.75rem; 
            color: #999; 
            background: #000;
            padding: 8px;
            border-radius: 6px;
            border: 1px solid #333;
        }

        .check-row input { width: auto; margin: 0; }

        #rainyContainer { 
            background: rgba(0, 150, 255, 0.1); 
            border: 1px dashed rgba(0, 150, 255, 0.4); 
            padding: 8px; 
            border-radius: 8px; 
            margin-top: 10px; 
            display: none; 
        }

        .result-box { 
            background: rgba(173, 216, 230, 0.05); 
            padding: 25px; 
            border-radius: 12px; 
            border: 1px solid rgba(173, 216, 230, 0.2); 
            text-align: center; 
            margin-top: 15px; 
        }

        .result-val { 
            font-size: 2.2rem; 
            font-weight: 800; 
            color: var(--accent); 
            font-variant-numeric: tabular-nums;
        }

        .footer { 
            display: flex; 
            justify-content: space-between; 
            align-items: center; 
            margin-top: 30px; 
            padding-top: 15px; 
            border-top: 1px solid #333; 
        }

        .discord-link { color: #7289da; font-size: 0.8rem; text-decoration: none; font-weight: bold; }
        
        .reset-btn { 
            background: #2a2a35; 
            color: #fff; 
            border: 1px solid #444; 
            padding: 8px 16px; 
            border-radius: 6px; 
            font-size: 0.75rem; 
            cursor: pointer; 
        }

        .reset-btn:hover { background: #3e3e4a; }

        .disclaimer { font-size: 0.65rem; color: #666; margin-top: 15px; text-align: center; line-height: 1.4; }

        /* Animation for resetting dropdown */
        @keyframes flash {
            0% { background-color: var(--accent); color: black; }
            100% { background-color: var(--input-bg); color: white; }
        }
        .flash-reset { animation: flash 0.6s ease-out; }

    </style>
</head>
<body>

<div class="calc-card">
    <form id="calcForm" onsubmit="return false;">
        <h2>Sols Rng</h2>
        
        <div class="mode-switch">
            <button type="button" id="btnChance" class="mode-btn active" onclick="setMode('chance')">CHANCE (%)</button>
            <button type="button" id="btnTime" class="mode-btn" onclick="setMode('time')">TIME REQ</button>
        </div>

        <div class="section">
            <label>Target Aura Rarity</label>
            <div class="rarity-container">
                <span class="prefix">1/</span>
                <input type="number" id="rarity" value="2500000000" placeholder="e.g. 1000000">
            </div>

            <label>Current Display Luck</label>
            <input type="number" id="luck" value="30" placeholder="Your luck stat">

            <div class="check-grid">
                <label class="check-row"><input type="checkbox" id="vip"> VIP (1.2x)</label>
                <label class="check-row"><input type="checkbox" id="vipPlus"> VIP+ (1.2x)</label>
                <label class="check-row" style="grid-column: span 2;"><input type="checkbox" id="event2x"> 2x Luck Event</label>
            </div>

            <label>Glove Gear</label>
            <select id="mult">
                <option value="1.98">Unfathomable Ruins</option>
                <option value="1.8">Darkshader</option>
                <option value="pole">Pole Light Core Device</option>
                <option value="grav">Gravitational Device</option>
                <option value="1.3">Flesh Device</option>
                <option value="jackpot">Jackpot Gauntlet</option>
                <option value="gemstone">Gemstone Gauntlet</option>
                <option value="xmas" class="event-item" data-event="true" style="display:none;">X-Mas Champion</option>
                <option value="present" class="event-item" data-event="true" style="display:none;">Present Giver</option>
                <option value="blessed" class="event-item" data-event="true" style="display:none;">Blessed Tide Gauntlet</option>
                <option value="tide" class="event-item" data-event="true" style="display:none;">Tide Gauntlet</option>
                <option value="1.35" class="event-item" data-event="true" style="display:none;">Ominous Coffin</option>
            </select>
            
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <label class="check-row" style="border: none; background: transparent;">
                    <input type="checkbox" id="showEvent" onchange="toggleEventGear()"> Show Event Gear
                </label>
            </div>

            <div id="rainyContainer">
                <label class="check-row" style="color: #add8e6; border-color: rgba(173, 216, 230, 0.4);">
                    <input type="checkbox" id="isRainy"> Rainy Aura? (Bonus Rarity / 4)
                </label>
            </div>
        </div>

        <div class="section">
            <label>Roll Speed</label>
            <div style="display:flex; gap:10px; align-items: center;">
                <input type="number" id="speedR" value="20" title="Rolls">
                <span style="color: #666;">/</span>
                <input type="number" id="speedS" value="10" title="Seconds">
                <span style="font-size: 0.7rem; color: #888;">sec</span>
            </div>
        </div>

        <div id="sectionChance" class="section">
            <label>Time Spent (Days)</label>
            <input type="number" id="days" value="1" placeholder="Days to roll">
            <div class="result-box">
                <label style="color: var(--text-dim); font-size: 0.7rem;">ESTIMATED PROBABILITY</label>
                <div class="result-val" id="outputChance">0.00%</div>
            </div>
        </div>

        <div id="sectionTime" class="section" style="display:none;">
            <label>Target Confidence (%)</label>
            <input type="number" id="targetP" value="50" placeholder="e.g. 50">
            <div class="result-box">
                <label style="color: var(--text-dim); font-size: 0.7rem;">DAYS REQUIRED</label>
                <div class="result-val" id="outputTime">--</div>
            </div>
        </div>

        <div class="disclaimer">
            Math uses the Giant Equation: unwrapping display luck, applying glove modifiers, and calculating cumulative probability. Success is never 100% guaranteed.
        </div>

        <div class="footer">
            <div class="footer-left">
                <a href="https://discord.gg/yTreH64JBC" class="discord-link" target="_blank">Discord</a>
                <div style="font-size:0.6rem; color:#444;">LubJub v2.0</div>
            </div>
            <button type="button" class="reset-btn" onclick="fullReset()">Reset All</button>
        </div>
    </form>
</div>

<script>
    let currentMode = 'chance';
    let calcTimeout;

    // LAG-FREE DEBOUNCE
    function debouncedCalculate() {
        clearTimeout(calcTimeout);
        calcTimeout = setTimeout(calculate, 150);
    }

    function setMode(mode) {
        currentMode = mode;
        document.getElementById('sectionChance').style.display = (mode === 'chance') ? 'block' : 'none';
        document.getElementById('sectionTime').style.display = (mode === 'time') ? 'block' : 'none';
        document.getElementById('btnChance').classList.toggle('active', mode === 'chance');
        document.getElementById('btnTime').classList.toggle('active', mode === 'time');
        calculate();
    }

    function fullReset() {
        document.getElementById('calcForm').reset();
        document.getElementById('showEvent').checked = false;
        toggleEventGear();
        setMode('chance');
    }

    function toggleEventGear() {
        const isChecked = document.getElementById('showEvent').checked;
        const select = document.getElementById('mult');
        const items = document.getElementsByClassName('event-item');
        
        for (let item of items) { 
            item.style.display = isChecked ? "block" : "none"; 
        }

        const currentOption = select.options[select.selectedIndex];
        if (!isChecked && currentOption.getAttribute('data-event') === "true") {
            select.value = "1.98"; 
            // Visual feedback for the auto-reset
            select.classList.add('flash-reset');
            setTimeout(() => select.classList.remove('flash-reset'), 600);
        }
        checkRainySupport();
    }

    function checkRainySupport() {
        const glove = document.getElementById('mult').value;
        const container = document.getElementById('rainyContainer');
        container.style.display = (glove === "tide" || glove === "blessed") ? "block" : "none";
        calculate();
    }

    function calculate() {
        // 1. Inputs
        const rarity = parseFloat(document.getElementById('rarity').value) || 1;
        const displayLuck = parseFloat(document.getElementById('luck').value) || 0;
        const glove = document.getElementById('mult').value;
        const isRainy = document.getElementById('isRainy').checked;
        
        // 2. Calculate Final Multiplier (Gamepasses/Events)
        let finalMult = 1;
        const v1 = document.getElementById('vip').checked;
        const v2 = document.getElementById('vipPlus').checked;
        const e2 = document.getElementById('event2x').checked;

        if (v1 && v2) finalMult = 1.3;
        else if (v1 || v2) finalMult = 1.2;
        if (e2) finalMult *= 2;

        // 3. Unwrap and Rewrap Math
        let rawLuck = displayLuck / finalMult;
        let pAvg;
        let speedMult = 1;
        const rainyDiv = isRainy ? 4 : 1;

        if (glove === "blessed") {
            // Blessed handles internal ratios differently
            pAvg = (5 * (rawLuck / rarity) + 1 * ((rawLuck * 3) / (rarity / rainyDiv))) / 6;
            pAvg *= finalMult; 
        } else if (glove === "tide") {
            pAvg = (9 * ((rawLuck + 0.5) / rarity) + 1 * (((rawLuck + 0.5) * 2) / (rarity / rainyDiv))) / 10;
            pAvg *= finalMult;
        } else {
            let L_add = 0, M_glove = 1;
            if (glove === "pole") { 
                L_add = 5; 
                M_glove = 1.1; 
                speedMult = 34 / 30; // Pole Light Burst logic
            }
            else if (glove === "grav") { M_glove = 1.5; }
            else if (glove === "jackpot") { L_add = 0.77; }
            else if (glove === "gemstone") { L_add = 0.075; }
            else if (glove === "xmas") { M_glove = 1.5; }
            else if (glove === "present") { M_glove = 1.36; }
            else if (glove === "1.35") { M_glove = 1.35; } 
            else { M_glove = parseFloat(glove) || 1; }
            
            pAvg = ((rawLuck + L_add) * M_glove * finalMult) / rarity;
        }

        // 4. Roll Volume
        const rollsPerDay = (parseFloat(document.getElementById('speedR').value) / parseFloat(document.getElementById('speedS').value)) * 86400 * speedMult;

        // 5. ASYMPTOTIC CHANCE LOGIC
        const d = parseFloat(document.getElementById('days').value) || 0;
        const P = d > 0 ? 1 - Math.pow((1 - pAvg), (rollsPerDay * d)) : 0;
        
        let displayChance = "";
        if (P >= 0.9999999) displayChance = "99.9999%+";
        else if (P > 0.99) displayChance = (P * 100).toFixed(4) + "%";
        else displayChance = (P * 100).toFixed(2) + "%";
        
        document.getElementById('outputChance').innerText = displayChance;

        // 6. TIME REQUIRED LOGIC
        const targetP = (parseFloat(document.getElementById('targetP').value) || 0) / 100;
        if (targetP > 0 && targetP < 1 && pAvg > 0) {
            const neededDays = (Math.log(1 - targetP) / Math.log(1 - pAvg)) / rollsPerDay;
            document.getElementById('outputTime').innerText = Math.max(0, neededDays).toFixed(2) + " Days";
        } else {
            document.getElementById('outputTime').innerText = "--";
        }
    }

    // Event Listeners for all inputs
    document.querySelectorAll('input, select').forEach(el => {
        el.addEventListener('input', debouncedCalculate);
    });
    
    // Check rainy container on initial load
    document.getElementById('mult').addEventListener('change', checkRainySupport);

    // Initial run
    calculate();
</script>

</body>
</html>
